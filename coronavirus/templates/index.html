<!DOCTYPE html>
<!-- saved from url=(0060)https://www.chartjs.org/samples/latest/scales/time/line.html -->
<html xml:lang="en" lang="en" xmlns:fb="http://ogp.me/ns/fb#">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Coronavirus Chart - compare countries & world prediction & counter</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Chart of 2019-nCoV infected, dead, and forecast with intraday counter, compare countries, your probability of infection.">
	<meta name="keywords" content="coronavirus,chart,history,graph,logaritmic scale,log scale,logaritmic,news">
	<link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

	<!--	<script async="" src="./index_files/analytics.js"></script>-->

<!--	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>
<!--	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.27/moment-timezone-with-data-1970-2030.min.js"></script>-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.27/moment-timezone-with-data.min.js"></script>


<!--	<script src="./index_files/Chart.min.js"></script>-->
	<script src="https://www.chartjs.org/dist/2.9.3/Chart.min.js"></script>


<!--	<script src="./index_files/utils.js"></script>-->
	<script src="https://www.chartjs.org/samples/latest/utils.js"></script>
	<style>

		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}

		h1 {
			font-size: calc(15px + 5vmin);
			color: #000000;
			/*text-shadow: 2px 2px 2px #688200;*/
		}

		button, select {
			font-size: calc(7px + 1vmin);
            background-color: white;
			color: #000000;
			border-radius: 0;
			border-width: 1px;
			box-shadow:inset 0px 1px 0px 0px #fff6af;
			border:1px solid #000000;
			margin: 2px;

		}

		a,a:visited {
			color:  #000000;
		}

		li { margin-top: 10px }

	</style>
<style type="text/css">/* Chart.js */
@keyframes chartjs-render-animation {
	from {
		opacity: .99
	}
	to {
		opacity: 1
	}
}

.chartjs-render-monitor {
	animation: chartjs-render-animation 1ms
}

.chartjs-size-monitor, .chartjs-size-monitor-expand, .chartjs-size-monitor-shrink {
	position: absolute;
	direction: ltr;
	left: 0;
	top: 0;
	right: 0;
	bottom: 0;
	overflow: hidden;
	pointer-events: none;
	visibility: hidden;
	z-index: -1
}

.chartjs-size-monitor-expand > div {
	position: absolute;
	width: 1000000px;
	height: 1000000px;
	left: 0;
	top: 0
}

.chartjs-size-monitor-shrink > div {
	position: absolute;
	width: 200%;
	height: 200%;
	left: 0;
	top: 0
}</style>
</head>

<body>

	<div style="align-content: center; text-align: center; display: flex; justify-content: center;">
		<div style="max-width: 1400px; width: 98.5%">
			<h1 style="margin-bottom: 5px">&#x1F4C8; Coronavirus Chart</h1>
			<h2><span style="color: red">‚Ä¢ Live</span> <span style="color: blue">Prediction</span></h2>
			<br>
			<i>
				Updated 2020-04-09 07:00 UTC - <b style="color: darkorange">Infection counts are slowing down, death counts are lagging. Is that due to restrictions or due to sufficient herd immunity? Immunity investigated in <a href="https://www.medrxiv.org/content/10.1101/2020.03.30.20047365v1">this Chinese study</a>.</b><br><br>
				 <b style="color: darkorange; text-shadow: 1px 1px 0 #688200;">Real-time prediction counter</b>, an interactive chart of 4 day forecast, comparison of countries, probability of your infection, latest news, quiz, and discussion about the novel coronavirus. Updated daily. Predictions are <b style="color: blue">blue points</b>.
			</i>
			<br>
			<br>
			<div style="color: darkorange; text-shadow: 1px 1px 0 #688200; width: auto; font-size: xx-large; font-weight: bold; margin: 10px;">
				~ <span id="infectedCount" >Predicted infected count calculating...</span><span> infected</span>
			</div>
			<i style="font-size: small">Above is <b style="color: blue;">real-time intraday prediction</b> based on the model below.</i>
			<br>
            <br>
			<br>
				<div class="chartjs-size-monitor">
					<div class="chartjs-size-monitor-expand">
						<div class=""></div>
					</div>
					<div class="chartjs-size-monitor-shrink">
						<div class=""></div>
					</div>
				</div>
				<canvas id="canvas" style="display: block" class="chartjs-render-monitor"></canvas>
			<br>
			<button id="toggleScale" style="border-radius: 0"><b>‚à° Logaritmic / Linear Scale Toggle</b></button><br>

			<br>
			The prediction of the outbreak progression is based on a very simple assumption that the counts will at first follow an exponential curve, at least at the beginning of the outbreak. Over time, instead, the s-curve shape will become dominant. The log scale chart of the time-series shows that growth of infected count currently is <b id="iDailyGrowthPercent" style="color: darkorange"> loading ... </b> per day (geometric progression). Since the parameters of the geometric progression are changing, the prediction is calculated using only the latest 5 data points.<br>
			The time-series graph above tracks 2019‚Äì20 Wuhan coronavirus COVID19 (2019-nCoV, SARS-CoV-2) outbreak. The basic reproduction number is around 2.6 new infected per one sick. Common symptoms include fever, cough, and shortness of breath. Time from exposure to developing symptoms (incubation) of the virus is 2 - 14 days.<br>

			<br>
			<h2 id="compareCountriesHead"> 	üîç Compare countries</h2>
			Add your countries of interest via dropdown and button below. I recommend to use log-scale to contrast and compare growth acceleration of different countries. The data is thanks to Hopkins.<br>
			<span>
                <select id="locationSelect" style="width: 150px"></select>
				<button id="clearDatasets" style="border-radius: 0"><b>Clear</b></button>
				<button id="toggleScalePerCountry" style="border-radius: 0"><b>‚à° Log Scale Toggle</b></button>
			</span>
			<div class="chartjs-size-monitor">
				<div class="chartjs-size-monitor-expand">
					<div class=""></div>
				</div>
				<div class="chartjs-size-monitor-shrink">
					<div class=""></div>
				</div>
			</div>
			<canvas id="canvasPerCountry" style="display: block" class="chartjs-render-monitor"></canvas>

			<br>
			<br>
			<a class="twitter-share-button" style="background: #55ACEE; color: white; padding: 7px; border-radius: 10px; text-decoration: none" href="https://twitter.com/intent/tweet?text=Stay%20away%20from%20crowds%2C%20wash%20hands%2C%20don%27t%20touch%20eyes%20%26%20mouth%2C%20stock%20up%2C%20and%20monitor%20situation%20https%3A%2F%2Fwww.CoronavirusChart.com%2F"><i class="fa fa fa-twitter"></i> Inform your friends with a Tweet</a><br>
			<br>
			<a class="" style="background: #1877f2; color: white; padding: 7px; border-radius: 10px; text-decoration: none" href="https://facebook.com/sharer.php?u=https%3A%2F%2Fwww.coronaviruschart.com%2F&quote=Stay%20away%20from%20crowds%2C%20wash%20hands%2C%20don%27t%20touch%20eyes%20%26%20mouth%2C%20stock%20up%2C%20and%20monitor%20situation%20https%3A%2F%2Fwww.CoronavirusChart.com%2F"><i class="fa fa fa-facebook"></i> Inform your friends with a fb post</a>
			<br>
			<br>


			<h2>‚ò£ Probability of meeting the infected</h2>
			<div style="text-align: left">
    			Fill in your local numbers and click calculate. This is just a simple estimate and there may be a bug in the calculation. But it is the best I have as of 2020-03-12. It is calculated by estimating probability of not meeting any of the infected, but unconfirmed (not quarantined) people. The infected people are estimated based on claim that 80% of cases have mild symptoms and are not reported.

    			<script>
    				function getElementInt(id) {
    					return parseInt(document.getElementById(id).value)
    				}

    				function calc() {
    					let pop = getElementInt('population');
    					let confirmed = getElementInt('confirmed-cases');
    					let infected = (confirmed / 20) * 80;
    					let meet = getElementInt('population-meet');
    					document.getElementById('total-infected').innerText = infected.toString();
    					// document.getElementById('probability').innerText = Math.floor((1 - Math.pow((1 - infected / pop), meet)) * 100).toString() + '%';

    					if (pop <= infected) {
    						alert('Population less than infected count!');
    						document.getElementById('probability').innerText = '100%';

    					} else if (meet >= pop || meet >= infected) {
    						alert('Number of met people is too large!');
    						document.getElementById('probability').innerText = '100%';

    					} else {
    						let probOfNot = 1;
    						for (let i = 0; i < meet; i++) {
    							probOfNot = probOfNot * (1 - infected / (pop - i));
    						}
    						document.getElementById('probability').innerText = Math.floor((1 - probOfNot) * 100).toString() + '%';

    					}

    				}


    			</script>

    			<table>
        			<tr><td><label for="population">Population: </label></td><td><input type="number" id="population" value="1000000"/></td></tr>
        			<tr><td><label for="confirmed-cases">Confirmed active cases: </label></td><td><input type="number" id="confirmed-cases" value="94"/></td></tr>
        			<tr><td><label for="population-meet">Random people I meet in day: </label></td><td><input type="number" id="population-meet" value="100"/></td></tr>
        			<tr><td>Total infected not quarantined:</td><td><span id="total-infected">?</span></td></tr>
        			<tr><td>Daily probability meeting one or more infected person:</td><td><span id="probability">?</span></td></tr>
        			<tr><td></td><td></td></tr>
        			<tr><td><button type="button" onclick="calc()">Calculate</button></td><td></td></tr>
    			</table>
    		</div>
			<br>
			<br>



			<h2> &nbsp;üì∞Latest News</h2>

			<ul id="news" style="text-align: left;">Loading...</ul>
			<br>

			<h2>üÉè Today's Joke</h2>
			<img src="/cough-text.webp" alt="mask do help" style="width: 90%; max-width: 700px" /><br>
			<br>

			<h2>üè• Advanced Tips</h2>
			<ul style="text-align: left;">
			    <li><a href="https://twitter.com/DrMattMcCarthy/status/1238939403206221824?s=20">Remdesivir</a> and <a href="https://www.jstage.jst.go.jp/article/bst/advpub/0/advpub_2020.01047/_pdf/-char/en">hydroxychloroquine</a> shows promise in Covid-19 treatment, but deployment to your hospital could take months. Vaccine likely arrives in 2021. Isolation still the best as South Korea and China show.</li>
			    <li><a href=" https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2440799/">Various kinds of masks do seem to weakly protect (best are FFP3, N95) if worn correctly</a>. But social/crowd distancing is the best - number of doctors got infected despite wearing them.</li>
			    <li>Compilation of many tips - <a href="https://www.reddit.com/r/sydney/comments/fg65kj/psa_regarding_covid19_a_warning/">on Reddit</a></li>
			    <li>If 1/n people are infected with a disease, a gathering of .7n people is likely to include at least one infected person. E.g. if 1% of people are infected, n = 100, so any gathering of 70 or more people probably includes an infected person.<a href="https://twitter.com/paulg/status/1236361589927927808?s=20">P. Graham</a></li>
			    <li><a href="https://www.medrxiv.org/content/10.1101/2020.03.04.20031104v1.full.pdf">2020-03-08 mortality estimates still based on Feb Chinese data</a>: Age 0-9: 0.0094% Age 10-19: 0.022% Age 20-29: 0.091% Age 30-39: 0.18% Age 40-49: 0.4% Age 50-59: 1.3% Age 60-69: 4.6% Age 70-79: 9.8% Age 80+: 18%</li>
			    <li><a href="https://institutefordiseasemodeling.github.io/nCoV-public/analyses/first_adjusted_mortality_estimates_and_risk_assessment/2019-nCoV-preliminary_age_and_time_adjusted_mortality_rates_and_pandemic_risk_assessment.html">A preliminary analysis estimates Covid-19 as comparable to Spanish flu</a> in transmissibility and severity.</li>
			    <li>Infected <a href="https://www.journalofhospitalinfection.com/article/S0195-6701(20)30046-3/fulltext">surfaces could be infectious up to two days!</a> Disinfect and wear gloves.</li>
			    <li>Younger people seem to be in less risk of severe impact, but there isn't enough data.</li>
			    <li>Re-infection <a href="https://t.co/Ezx2P3RpjL?amp=1">probably not possible with the same strain</a>. Though multiple virus mutations may exist: <a href="https://academic.oup.com/nsr/advance-article/doi/10.1093/nsr/nwaa036/5775463">S-type and L-type mutation</a>.</li>
			    <li>Large shortages in various goods will soon come due low manufacturing, low resupply, and stockpiling. China reported lowest manufacturing index since 2008. But is coming back online now.</li>
			    <li>Speculation: You can only limit the virus dose and postpone the time, but you will be infected eventually. If you will get sick after the pandemic, you may get better treatment and the docs may be prepared and resupplied.</li>
			    <li>The time between exposure and symptom onset is typically around 5 days, ranging 2 - 14 days. The time between symptom onset and death is typically around 14 days, ranging 6 - 41 days</li>
			    <li>Please make it through this and let me know if you have any suggestions.</li>
			</ul>
			<br>


			<h2>üë®‚Äç‚öïÔ∏è Coronavirus Prevention Quiz</h2>
            (Autogenerated quiz via <a href="https://quizrecall.com" style="color: orange; text-shadow: 1px 1px black; font-weight: bold">Quizrecall</a> from <a href="https://www.cdc.gov/coronavirus/2019-ncov/about/prevention-treatment.html">CDC's text</a>.)<br><br>
            <a href="https://www.coronaviruschart.com/coronavirus-quiz.pdf">‚á© Download a pdf</a>.


			<div style="text-align: left">


			<h3>Question 1</h3>
			The best way to prevent infection is to {{ ... }}.<br>

			<ol type="a">
				<li>
					avoid being exposed to this virus
				</li>
				<li>
					be concerned about the risk of infection as well
				</li>
				<li>
					keep your hands on the soap
				</li>
			</ol>



			<h3>Question 2</h3>
			However, as a reminder, CDC always recommends everyday preventive actions to help prevent the spread of respiratory viruses, including: Wash your {{ ... }}.<br>

			<ol type="a">
				<li>
					hands, give every bite a chance to keep your nose open
				</li>
				<li>
					hands every day until you get a flu shot, get vaccinated, stay under control for 24
				</li>
				<li>
					hands often with soap and water for at least 20 seconds
				</li>
			</ol>


			<h3>Question 3</h3>
			Use an alcohol-based hand sanitizer that contains {{ ... }}.<br>

			<ol type="a">
				<li>
					antifungal immunoprecipients, not salt; run an inflatable swimming pool
				</li>
				<li>
					a soap bottle, scrubbing your hands frequently, washing hands frequently, combing your hands often
				</li>
				<li>
					at least 60% alcohol if soap and water are not available
				</li>
			</ol>



			<h3>Question 4</h3>
			Avoid touching your eyes, nose, and {{ ... }}.<br>

			<ol type="a">
				<li>
					mouth with unwashed hands
				</li>
				<li>
					neck, especially when wearing your shoes
				</li>
				<li>
					nose, as the infection can spread
				</li>
			</ol>


			<h3>Question 5</h3>
			Avoid close contact with {{ ... }}.<br>

			<ol type="a">
				<li>
					people who are sick
				</li>
				<li>
					your eyes when using soap during
				</li>
				<li>
					washing hands with soap
				</li>

			</ol>


			<h3>Question 6</h3>
			Stay home when you {{ ... }}.<br>

			<ol type="a">

				<li>
					need to use
				</li>

				<li>
					have to be
				</li>
				<li>
					are sick
				</li>
			</ol>


			<h3>Question 7</h3>
			Cover your cough or sneeze with a tissue, then throw {{ ... }}.<br>
			<ol type="a">
				<li>
					your hands up, arms, hands, face
				</li>
				<li>
					the tissue in the trash
				</li>
				<li>
					it on the floor
				</li>

			</ol>


			<h3>Question 8</h3>
			Clean and disinfect frequently touched {{ ... }}.<br>

			<ol type="a">
				<li>
					objects and surfaces
				</li>

				<li>
					surfaces where you cannot
				</li>
				<li>
					tissues with dental iron
				</li>
			</ol>

			<h3>Question 9</h3>
			These are everyday habits that can help prevent {{ ... }}.<br>

			<ol type="a">
				<li>
					the spread of several viruses
				</li>
				<li>
					self-harm, destruction, more
				</li>
				<li>
					choking, but are one of the most important
				</li>
			</ol>

			<br>
			<div>
				Solution:
				<div style="transform: rotate(180deg); text-align: right">
					1. a,
					2. c,
					3. c,
					4. a,
					5. a,
					6. c,
					7. b,
					8. a,
					9. a,
				</div>
			</div>
			<br>
			<a href="https://quizrecall.com" style="flex-direction: column; display: flex; font-size: 8px; text-align: left; color: black; text-decoration: none">
				<img src="/quizrecall-logo-transparent-shadow-w200px.png" alt="Quizrecall.com Logo" width="100px">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;generated with
			</a>

			<br>


			</div>

			<br>
			<h3>üìí Data Sources</h3>
			Currently all data comes from <a href="https://github.com/CSSEGISandData/COVID-19">Hopkins</a>. On days prior 2020-04-05 the data was sourced from Wiki as described below.<br>
			The data is updated daily from <a href="https://en.wikipedia.org/wiki/2019%E2%80%9320_Wuhan_coronavirus_outbreak">Wuhan coronavirus outbreak wiki page</a>.<br>
			The very early data till 2020-02-25 are sourced from various web pages since I found no good single source with both infected and dead historical data. The historical infected were collected from  <a href="https://en.wikipedia.org/wiki/2019%E2%80%9320_Wuhan_coronavirus_outbreak">a wiki</a> based on the expectation that before 2020-01-28, almost all infected and dead were in China.
			The data point for 2020-01-29 comes from the global estimates on the wiki linked refered to as "As of 30 January 2020". The historical data for the death toll comes from an page I cannot find now. And are then combined with the data point from NY Times 2020-01-27 and the wiki one for 2020-01-27.<br>
			<br>

			<h2>üôã Disqus</h2>
			<div id="disqus_thread"></div>
            <script>
            /**
            *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
            *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
            /*
            var disqus_config = function () {
            this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
            };
            */
            (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://coronavirus-chart.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
            })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


			<!-- <a class="twitter-timeline" href="https://twitter.com/WHO?ref_src=twsrc%5Etfw">Tweets by WHO</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> -->


			<script src="/jquery-3.3.1.slim.min.js"></script>
			<script src="/jquery.csv.min.js"></script>

			<script>
				let worldPlusChinaData = [
					{ d: '2020-01-16', i: 45, t: 1, w: 0},
					{ d: '2020-01-17', i: 62, t: 2, w: 0},
					{ d: '2020-01-18', i: 121, t: 3, w: 0},
					{ d: '2020-01-19', i: 198, t: 4, w: 0},
					{ d: '2020-01-20', i: 291, t: 4, w: 0},
					{ d: '2020-01-21', i: 440, t: 6, w: 0},
					{ d: '2020-01-22', i: 571, t: 22, w: 9},
					{ d: '2020-01-23', i: 830, t: 25, w: 15},
					{ d: '2020-01-24', i: 1287, t: 41, w: 30},
					{ d: '2020-01-25', i: 1975, t: 55, w: 40},
					{ d: '2020-01-26', i: 2744, t: 80, w: 56},
					{ d: '2020-01-27', i: 4515, t: 106, w: 66},
					{ d: '2020-01-28', i: 6171, t: 133, w: 84},
					{ d: '2020-01-29', i: 7823, t: 170, w: 102},
					{ d: '2020-01-30', i: 9822, t: 213, w: 129},
					{ d: '2020-01-31', i: 11951, t: 259, w: 157},
					{ d: '2020-02-01', i: 14556, t: 305, w: 171},
					{ d: '2020-02-02', i: 17390, t: 362, w: 184},
					{ d: '2020-02-03', i: 20629, t: 427, w: 188},
					{ d: '2020-02-04', i: 24553, t: 492, w: 229},
					{ d: '2020-02-05', i: 28276, t: 565, w: 258},
					{ d: '2020-02-06', i: 31481, t: 639, w: 278},
					{ d: '2020-02-07', i: 34902, t: 724, w: 330},
					{ d: '2020-02-08', i: 37567, t: 813, w: 354},
					{ d: '2020-02-09', i: 40614, t: 910, w: 382},
					{ d: '2020-02-10', i: 43102, t: 1018, w: 461},
					{ d: '2020-02-11', i: 45171, t: 1115, w: 517},
					{ d: '2020-02-12', i: 60374, t: 1369, w: 522},
					{ d: '2020-02-13', i: 64451, t: 1383, w: 586},
					{ d: '2020-02-14', i: 67102, t: 1526, w: 608},
					{ d: '2020-02-15', i: 69270, t: 1669, w: 697},
				    { d: '2020-02-16', i: 71330, t: 1775, w: 781},
				    { d: '2020-02-17', i: 73424, t: 1874, w: 896},
				    { d: '2020-02-18', i: 75200, t: 2010, w: 999},
					{ d: '2020-02-19', i: 75727, t: 2128, w: 1150},
					{ d: '2020-02-20', i: 76245, t: 2247, w: 1257},
					{ d: '2020-02-21', i: 77815, t: 2360, w: 1527},
					{ d: '2020-02-22', i: 78773, t: 2462, w: 1837},
                    { d: '2020-02-23', i: 79561, t: 2619, w: 2411},
                    { d: '2020-02-24', i: 80151, t: 2701, w: 2493},
                    { d: '2020-02-25', i: 81000, t: 2764, w: 2936},
                    { d: '2020-02-26', i: 82167, t: 2801, w: 3670},
                    { d: '2020-02-27', i: 83370, t: 2858, w: 4546},
                    { d: '2020-02-28', i: 85216, t: 2924, w: 5965},
                    { d: '2020-02-29', i: 86985, t: 2980, w: 7161},
                    { d: '2020-03-01', i: 89073, t: 3045, w: 9047},
                    { d: '2020-03-02', i: 90936, t: 3118, w: 10785},
                    { d: '2020-03-03', i: 93158, t: 3203, w: 12888},
                    { d: '2020-03-04', i: 95438, t: 3284, w: 15029},
                    { d: '2020-03-05', i: 98369, t: 3383, w: 17817},
                    { d: '2020-03-06', i: 102173, t: 3493, w: 21522},
                    { d: '2020-03-07', i: 106165, t: 3594, w: 25470},
                    { d: '2020-03-08', i: 110041, t: 3825, w: 29306},
                    { d: '2020-03-09', i: 113739, t: 4016, w: 32985},
                    { d: '2020-03-10', i: 119217, t: 4299, w: 38439},
                    { d: '2020-03-11', i: 126000, t: 4634, w: 45204},
                    { d: '2020-03-12', i: 134769, t: 4983, w: 53955},
                    { d: '2020-03-13', i: 145632, t: 5436, w: 64808},
                    { d: '2020-03-14', i: 156948, t: 5839, w: 76099},
                    { d: '2020-03-15', i: 169605, t: 6518, w: 88745},
                    { d: '2020-03-16', i: 182609, t: 7171, w: 101728},
                    { d: '2020-03-17', i: 198513, t: 7988, w: 117619},
                    { d: '2020-03-18', i: 220313, t: 8983, w: 139385},
                    { d: '2020-03-19', i: 245641, t: 10051, w: 164674},
                    { d: '2020-03-20', i: 276587, t: 11415, w: 195579},
                    { d: '2020-03-21', i: 308257, t: 13068, w: 227203},
                    { d: '2020-03-22', i: 338448, t: 14691, w: 257394},
                    { d: '2020-03-23', i: 381653, t: 16558, w: 300482},
                    { d: '2020-03-24', i: 422829, t: 18909, w: 341611},
					{ d: '2020-03-25', i: 471036, t: 21284, w: 389751},
					{ d: '2020-03-26', i: 532237, t: 24089, w: 532237-81340},
					{ d: '2020-03-27', i: 597252, t: 27365, w: 597252-81394},
					{ d: '2020-03-28', i: 663748, t: 30880, w: 663748-81394},
					{ d: '2020-03-29', i: 723700, t: 34018, w: 723700-81470},
					{ d: '2020-03-30', i: 785979, t: 37810, w: 785979-87956},
					{ d: '2020-03-31', i: 859032, t: 42322, w: 859032-81554},
					{ d: '2020-04-01', i: 937567, t: 47256, w: 937567-81589},
					{ d: '2020-04-02', i: 1016128, t: 53069, w: 1016128-81620},
					{ d: '2020-04-03', i: 1141190, t: 60960, w: 0},
					{ d: '2020-04-04', i: 1203099, t: 64774, w: 0},

				];

				let sourceDataLength = worldPlusChinaData.length;

				// FIXME move this into loop after csv parsing
				let ahead = 4;
				// let [data, infectedNow, iDailyGrowthPercent] = predict(worldPlusChinaData, ahead);

				var color = Chart.helpers.color;

				function pointColors(normalColor, sourceDataLength, ahead) {
					let bcs = [];
					for (let i = 0; i < sourceDataLength + ahead; i++) {
						if (i < sourceDataLength) {
							bcs.push(normalColor);
						} else {
							bcs.push(color(window.chartColors.blue).alpha(1).rgbString());
						}
					}
					return bcs;
				}

				let bcs = pointColors(color(window.chartColors.yellow).alpha(1).rgbString(), sourceDataLength, ahead);
				let tbcs = pointColors(color(window.chartColors.red).alpha(1).rgbString(), sourceDataLength, ahead);
				let wbcs = pointColors(color(window.chartColors.purple).alpha(1).rgbString(), sourceDataLength, ahead);



				var type = 'linear';

				var timeFormat = 'YYYY-MM-DD';

				var config = {
					type: 'line',
					data: {
						labels: [],
						datasets: [
							// {
							// 	label: '‚ò£  Infected',
							// 	backgroundColor: color(window.chartColors.yellow).alpha(1).rgbString(),
							// 	borderColor: window.chartColors.yellow,
							// 	pointBackgroundColor: bcs,
							// 	pointBorderColor: bcs,
                            //     hidden: false,
							// 	fill: false,
							// 	data: data.map(d => d.i),
							// },
							// {
							// 	label: '‚úù Dead',
							// 	backgroundColor: color(window.chartColors.red).alpha(1).rgbString(),
							// 	borderColor: window.chartColors.red,
							// 	pointBackgroundColor: tbcs,
							// 	pointBorderColor: tbcs,
							// 	hidden: false,
							// 	fill: false,
							// 	data: data.map(d => d.t),
							// },
						]
					},
					options: {
						// maintainAspectRatio: false,
						title: {
							text: 'Coronavirus Infected and Dead Chart'
						},
						scales: {
							xAxes: [{
								type: 'time',
								time: {
									parser: timeFormat,
									round: 'day',
									tooltipFormat: 'll',
									unit: 'day',
									displayFormats: {
										day: 'DD/MM'
									}
								},
								scaleLabel: {
									display: true,
									labelString: 'Date'
								}
							}],
							yAxes: [{
								scaleLabel: {
									display: true,
									labelString: '# people (linear scale)'
								}
							}]
						},
					}
				};

				var configPerCountry = {
					type: 'line',
					data: {
						labels: [],
						datasets: []
                    },
					options: {
						// maintainAspectRatio: false,
						title: {
							text: 'Coronavirus Infected and Dead Chart'
						},
						scales: {
							xAxes: [{
								type: 'time',
								time: {
									parser: timeFormat,
									round: 'day',
									tooltipFormat: 'll',
									unit: 'day',
									displayFormats: {
										day: 'DD/MM'
									}
								},
								scaleLabel: {
									display: true,
									labelString: 'Date'
								}
							}],
							yAxes: [{
								scaleLabel: {
									display: true,
									labelString: '# people (logarithmic scale)'
								},
								type: 'logarithmic'
							}]
						},
					}
				};

				document.getElementById('toggleScale').addEventListener('click', function() {
					type = type === 'linear' ? 'logarithmic' : 'linear';
					window.myLine.options.title.text = 'Chart.js Line Chart - ' + type;
					window.myLine.options.scales.yAxes[0] = {
						scaleLabel: {
							display: true,
							labelString: `# people (${type} scale)`
						},
						type: type
					};

					window.myLine.update();
				});

				document.getElementById('toggleScalePerCountry').addEventListener('click', function() {
					type = type === 'linear' ? 'logarithmic' : 'linear';
					window.myLinePerCountry.options.title.text = 'Chart.js Line Chart - ' + type;
					window.myLinePerCountry.options.scales.yAxes[0] = {
					    scaleLabel: {
							display: true,
					    	labelString: `# people (${type} scale)`
						},
						type: type
					};

					window.myLinePerCountry.update();
				});


				var csvParsedPromise = Promise.all([
						window.fetch('/time_series_covid19_confirmed_global.csv'),
						window.fetch('/time_series_covid19_deaths_global.csv'),
				])
						.then(d => Promise.all([d[0].text(), d[1].text()]))
						.then(d => {
							var [confirmedCsv, deadCsv] = d;
							var locationNames = [];
							window.perCountry = {};
							d.forEach((csv, i) => {
								var suffix = '';
							    if (i === 1) {
							    	suffix = ' deaths'
								}
								var objects = $.csv.toObjects(csv);
								objects.forEach(o => {
									var locationName = o['Country/Region'] + suffix;
									delete o['Country/Region'];
									delete o['Province/State'];
									delete o['Lat'];
									delete o['Long'];

									var dataset = Object.values(o).map(v => parseInt(v));
									dataset.pop();

									if (window.perCountry['World Total' + suffix] === undefined) {
										window.perCountry['World Total' + suffix] = dataset;
										locationNames.push('World Total' + suffix);

									}
									if (configPerCountry.data.labels.length === 0) {
										let dateStrings = Object.keys(o)
												.map(day => moment(day, "MM-DD-YYYY").format('YYYY-MM-DD'))
												.slice(0, dataset.length);
										dates = dateStrings.map(day => new Date(day));
										configPerCountry.data.labels = dates;
										configPerCountry.data.dateStrings = dateStrings;

									} else {
										dataset.forEach((v, i) => {
											window.perCountry['World Total' + suffix][i] += v;

										});

									}

									// some countries have multiple regions that we need to add up
									if (!locationNames.includes(locationName)) {
										locationNames.push(locationName);
										window.perCountry[locationName] = dataset;

									} else {
										dataset.forEach((v, i) => {
											window.perCountry[locationName][i] += v;

										});

									}

								});
							});
							locationNames.sort().forEach(locationName => {
								var x = document.getElementById("locationSelect");
								var option = document.createElement("option");
								option.text = locationName;
								x.add(option);
							});

						});


				var colorNames = Object.keys(window.chartColors);

				function addWorldDataset(locationName, dsColor, dsName) {
					var data = [...window.perCountry[locationName]];
					let dateStrings = [...configPerCountry.data.dateStrings];
					let [predData, predDateStrings, now, dailyGrowth] = predictOne(data, dateStrings, 4);
					if (predDateStrings.length !== config.data.labels.length) {
						config.data.labels = predDateStrings.map(d => new Date(d));
					}
					let bcs = pointColors(color(dsColor).alpha(1).rgbString(), window.perCountry[locationName].length, ahead);
					var newDataset = {
						label: dsName,
						borderColor: dsColor,
						backgroundColor: color(dsColor).alpha(0.5).rgbString(),
						pointBackgroundColor: bcs,
						pointBorderColor: bcs,
						fill: false,
						data: predData
					};
					config.data.datasets.push(newDataset);
					window.myLine.update();


					if (locationName === 'World Total') {
						updateIC();
						document.getElementById('iDailyGrowthPercent').innerText = Math.floor(dailyGrowth).toString() + '%';

						function updateIC() {
							var data = [...window.perCountry[locationName]];
							let dateStrings = [...configPerCountry.data.dateStrings];
							let [predData, predDateStrings, now, dailyGrowth]  = predictOne(data, dateStrings, 4);
							document.getElementById('infectedCount').innerText = now.toString();

						}

						setInterval(updateIC, 500);
					}

				}

				function addCountryDataset(locationName) {
					var colorName = colorNames[configPerCountry.data.datasets.length % colorNames.length];
					var newColor = window.chartColors[colorName];
					// TODO add predictionOne
					// var data = [...window.perCountry[locationName]];
					// let dateStrings = configPerCountry.data.dateStrings;
					// var [predData, predDateStrings, now, dailyGrowth] = predictOne(data, dateStrings, 3);
					// TODO colorization:
					// let bcs = pointColors(color(window.chartColors.yellow).alpha(1).rgbString());

					var newDataset = {
						label: locationName,
						borderColor: newColor,
						backgroundColor: color(newColor).alpha(0.5).rgbString(),
						fill: false,
						data: window.perCountry[locationName]
					};
					configPerCountry.data.datasets.push(newDataset);
					window.myLinePerCountry.update();

				}


				document.getElementById('locationSelect').addEventListener('change', function() {
					var sel = document.getElementById('locationSelect');
					let option = sel.options[sel.selectedIndex];
					var locationName = option.value;
					addCountryDataset(locationName);
				});

				document.getElementById('clearDatasets').addEventListener('click', function() {
				   configPerCountry.data.datasets = [];
					window.myLinePerCountry.update();
				});

				window.onload = function() {
					var ctx = document.getElementById('canvas').getContext('2d');
					window.myLine = new Chart(ctx, config);

					csvParsedPromise.then(r => {
						var ctxPerCountry = document.getElementById('canvasPerCountry').getContext('2d');
						window.myLinePerCountry = new Chart(ctxPerCountry, configPerCountry);

						addCountryDataset('US');
						addCountryDataset('Italy');
						addCountryDataset('Spain');

						addWorldDataset('World Total', 'orange', '‚ò£  Infected');
						addWorldDataset('World Total deaths', 'red', '‚úù Dead');
					});

				};

				function findLineByLeastSquares(values_x, values_y) {
					var x_sum = 0;
					var y_sum = 0;
					var xy_sum = 0;
					var xx_sum = 0;
					var count = 0;

					/*
					 * The above is just for quick access, makes the program faster
					 */
					var x = 0;
					var y = 0;
					var values_length = values_x.length;

					if (values_length !== values_y.length) {
						throw new Error('The parameters values_x and values_y need to have same size!');
					}

					/*
					 * Above and below cover edge cases
					 */
					if (values_length === 0) {
						return [ [], [] ];
					}

					/*
					 * Calculate the sum for each of the parts necessary.
					 * FIT ONLY last 5!
					 */
					for (let i = values_length - 5; i< values_length; i++) {
						x = values_x[i];
						y = values_y[i];
						x_sum+= x;
						y_sum+= y;
						xx_sum += x*x;
						xy_sum += x*y;
						count++;
					}

					/*
					 * Calculate m and b for the line equation:
					 * y = x * m + b
					 */
					var m = (count*xy_sum - x_sum*y_sum) / (count*xx_sum - x_sum*x_sum);
					var b = (y_sum/count) - (m*x_sum)/count;


					return [m, b]
				}

				function predictOne(arr, dateStrings, ahead) {
					let dayIndexes = [...Array(arr.length).keys()];
					let logArr = arr.map(v => Math.log(v + 0.1));
					let [m, b] = findLineByLeastSquares(dayIndexes, logArr);
					let latestDateString = dateStrings[dateStrings.length - 1];
					let seconds = moment().diff(moment(latestDateString).add(1, 'days')) / 1000;
					let now = Math.floor(Math.exp((arr.length - 1 + seconds / (60*60*24)) * m + b));
					let previous_date = dateStrings[arr.length - 1];
					let range_end = arr.length + ahead;
					let range_start = arr.length;
					let last_known_value = arr[arr.length - 1];
					for (let i = range_start; i < range_end; i++) {
						let y = Math.floor(last_known_value * Math.exp((i - range_start + 1) * m));
						let datum = arr[i];
						arr.push(y);
						if (!dateStrings[i]) {
							let d = moment(previous_date).add(1,'days').format('YYYY-MM-DD');
							dateStrings.push(d);
						}
						previous_date = dateStrings[i]
					}
					let dailyGrowthPercent = (Math.exp(m) - 1) * 100;
					return [arr, dateStrings, now, dailyGrowthPercent];

				}

				function predict(data, ahead) {

					let log_infecteds = data.map(d=>Math.log(d.i));
					let log_toll = data.map(d=>Math.log(d.t));
					let log_world = data.map(d=>Math.log(d.w));
					let days = [...Array(data.length).keys()];

					let [m, b] = findLineByLeastSquares(days, log_infecteds);
					let [mt, bt] = findLineByLeastSquares(days, log_toll);
					let [mw, bw] = findLineByLeastSquares(days, log_world);

					let latest = data[log_infecteds.length - 1];
					let seconds = moment().diff(moment(latest.d).add(1, 'days')) / 1000;
					let infectedNow = Math.floor(Math.exp((log_infecteds.length - 1 + seconds / (60*60*24)) * m + b));
					let worldNow = Math.floor(Math.exp((log_world.length - 1 + seconds / (60*60*24)) * mw + bw));

					// predict next 3 values
					// let previous_date = data[log_infecteds.length - 1].d;
					let previous_date = undefined;
					for (let i = 0; i < log_infecteds.length + ahead; i++) {
						let y = Math.floor(Math.exp(i * m + b));
						let yt = Math.floor(Math.exp(i * mt + bt));
						let yw = Math.floor(Math.exp(i * mw + bw));
						let datum = data[i];
						if (!datum) {
							datum = {};
							datum.i = y;
							datum.t = yt;
							datum.w = yw;
							datum.d = moment(previous_date).add(1,'days').format('YYYY-MM-DD');
							data.push(datum);
						}
						datum.im = y;
						datum.tm = yt;
						datum.wm = yw;
						previous_date = datum.d
					}
					let iDailyGrowthPercent = (Math.exp(m) - 1) * 100;
					return [data, infectedNow, iDailyGrowthPercent];
				}

				window.fetch('https://health.machinesrental.com/?type=range&from=' + moment().add(-1, 'days').format('YYYY-MM-DD'))
					.then(r => r.json())
					.then(news => {
						document.getElementById('news').innerHTML =
								'<li>' +
									news.data.map(n => {
										let localDate = moment.tz(n.date, 'Europe/Berlin').local().format('MM/DD HH:mm');
										return `<b>${localDate}</b> <a href="${n.source_url}" rel="nofollow" target="_blank">${n.title}</a>`;
									})
									.slice(0, Math.min(10, news.data.length))
									.join('</li>\n<li>')
								+ '</li>';
					});


			</script>


			<br>
			<i style="font-size: small">üì¨ Report issues to: corowrrw [at] server135.web-hosting.com</i>

		</div>
	</div>

</body>
</html>